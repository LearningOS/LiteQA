{"result": {"folders": ["lab2"], "nr": 1333, "data": {"embed_links": []}, "created": "2019-05-15T06:34:06Z", "bucket_order": 3, "no_answer_followup": 0, "change_log": [{"anon": "no", "uid": "i5ehqgv6vgu535", "data": "jvounkqoug123r", "type": "create", "when": "2019-05-15T06:34:06Z"}, {"anon": "no", "uid": "hdjonbiyfs62ie", "data": "k2tw0enie1v3v8", "to": "jvounkqjzgg23q", "type": "i_answer", "when": "2019-11-11T03:48:52Z"}, {"anon": "no", "uid": "hdjonbiyfs62ie", "data": "k2tw2y09sf0zr", "type": "i_answer_update", "when": "2019-11-11T03:50:50Z"}], "bucket_name": "Today", "history": [{"anon": "no", "uid": "i5ehqgv6vgu535", "subject": "关于分页内存管理的三个阶段", "created": "2019-05-15T06:34:06Z", "content": "<p>打扰大家了&#xff0c;我想问大家几个关于分页内存建立过程的问题。</p>\n<p>1&#xff0c;实验指导书中说&#xff0c;从地址0到地址pages&#43; sizeof(struct Page) * <em>npage结束的物理内存空间设定为已占用物理内存空间。<em>地址pages&#43; sizeof(struct Page) * </em>npage以上的空间为空闲物理内存空间。空闲空间起始地址为</em></p>\n<pre><code>freemem = PADDR((uintptr_t)pages &#43; sizeof(struct Page) * npage);</code></pre>\n<p>其中pages是ucore 结束地址end向上round到下一个4KB page size的数值&#xff0c;freemem指的是空闲空间的起始地址。</p>\n<p></p>\n<p>然而在练习2(get_pte)的答案中&#xff0c;有下面几步</p>\n<pre>page = alloc_pages(1);<br />// pa is the physical addr that (struct Page) manages.\nuintptr_t pa = page2pa(page);</pre>\n<p>其中page2pa函数主要做了</p>\n<pre>(page - pages) &lt;&lt; PGSHIFT</pre>\n<p>也就是说在pages位置以上&#xff0c;struct Page的index决定了实际页的物理地址。第一个struct Page对应的实际页的物理地址就是0x0.</p>\n<p>但是地址0到地址pages&#43; sizeof(struct Page) * <em>npage结束</em>不应该是已占用空间吗&#xff1f;为啥也可以被分配呢&#xff1f;继续分配下去&#xff0c;不会把uCore(0x10000)的地址覆盖了吗&#xff1f;</p>\n<p>我可能是某些地方理解错误&#xff0c;麻烦大家指正一下&#xff0c;谢谢&#xff01;</p>\n<p></p>\n<p>2&#xff0c;代码中的 Virtual memory map我也同样不理解&#xff0c;Physical Remapped Memory 是用户可分配的内存吗&#xff1f;uCore的起始地址应该是PA: 0x100000&#xff0c;被包含在Physical Remapped Memory内&#xff0c;岂不是被覆盖了&#xff1f;</p>\n<pre> *     4G ------------------&gt; &#43;---------------------------------&#43;\n *                            |                                 |\n *                            |         Empty Memory (*)        |\n *                            |                                 |\n *                            &#43;---------------------------------&#43; 0xFB000000\n *                            |   Cur. Page Table (Kern, RW)    | RW/-- PTSIZE\n *     VPT -----------------&gt; &#43;---------------------------------&#43; 0xFAC00000\n *                            |        Invalid Memory (*)       | --/--\n *     KERNTOP -------------&gt; &#43;---------------------------------&#43; 0xF8000000 (PA:0x38000000)\n *                            |                                 |\n *                            |    Remapped Physical Memory     | RW/-- KMEMSIZE\n *                            |                                 |\n *     KERNBASE ------------&gt; &#43;---------------------------------&#43; 0xC0000000 (PA:0x00000000)\n *                            |                                 | &lt;&lt;&lt; <strong>这里为啥多画出一截&#xff1f;物理地址已经为负数了</strong>\n *                            |                                 |\n *                            |                                 |\n *                            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</pre>\n<p></p>"}], "type": "question", "tags": ["lab2", "student"], "tag_good": [], "unique_views": 152, "children": [{"folders": [], "data": {"embed_links": []}, "children": [], "created": "2019-11-11T03:48:52Z", "bucket_order": 3, "tag_endorse": [], "bucket_name": "Today", "id": "k2tw0enev8x3v7", "history": [{"anon": "no", "uid": "hdjonbiyfs62ie", "subject": "", "created": "2019-11-11T03:50:50Z", "content": "<p>由于内核的地址转换是线性的&#xff0c;内核空间的虚拟地址和物理地址的双向对应关系是可以直接用公式算的。这是一种简化实现。物理页在初始化时都是空闲的&#xff0c;然后内核占用的部分就被标记为占用了&#xff0c;不会重复分配的。你可以跟踪一下对应操作系统在什么时候完成的。</p>\n<p></p>\n<p>第二个问题没有看明白。请明确问题描述。</p>"}, {"anon": "no", "uid": "hdjonbiyfs62ie", "subject": "", "created": "2019-11-11T03:48:52Z", "content": "<p>由于内核的地址转换是线性的&#xff0c;内核空间的虚拟地址和物理地址的双向对应关系是可以直接用公式算的。这是一种简化实现。物理页在初始化时都是空闲的&#xff0c;然后内核占用的部分就被标记为占用了&#xff0c;不会重复分配的。你可以跟踪一下对应操作系统在什么时候完成的。</p>"}], "type": "i_answer", "tag_endorse_arr": [], "config": {}, "is_tag_endorse": false}], "tag_good_arr": [], "no_answer": 0, "id": "jvounkqjzgg23q", "config": {}, "status": "active", "drafts": null, "request_instructor": 0, "request_instructor_me": false, "bookmarked": 2, "num_favorites": 0, "my_favorite": false, "is_bookmarked": false, "is_tag_good": false, "q_edits": [], "i_edits": [], "s_edits": [], "t": 1643169784355, "default_anonymity": "no"}, "error": null, "aid": "kyv0v40zsvu302"}