{"result": {"folders": ["2017", "课堂问答", "lab4", "lecture13"], "nr": 1039, "data": {"embed_links": []}, "created": "2017-04-10T08:15:32Z", "bucket_order": 3, "no_answer_followup": 2, "change_log": [{"anon": "no", "uid": "hdjonbiyfs62ie", "data": "j1bufci583p2od", "type": "create", "when": "2017-04-10T08:15:32Z"}, {"anon": "no", "uid": "isyhiuebva42er", "to": "j1bufci0nvi2oc", "type": "followup", "when": "2018-04-17T01:05:22Z"}, {"anon": "no", "uid": "je2ib3svwgf6af", "to": "j1bufci0nvi2oc", "type": "followup", "when": "2018-04-17T01:10:35Z"}, {"anon": "no", "uid": "i0boovu8sh63xb", "to": "j1bufci0nvi2oc", "type": "followup", "when": "2018-04-17T01:11:57Z"}, {"anon": "no", "uid": "je2ib3svwgf6af", "to": "j1bufci0nvi2oc", "type": "feedback", "when": "2018-04-17T01:37:08Z"}, {"anon": "no", "uid": "isvxeq6bspf1vn", "to": "j1bufci0nvi2oc", "type": "followup", "when": "2018-04-18T16:39:27Z"}, {"anon": "no", "uid": "isyhiuebva42er", "to": "j1bufci0nvi2oc", "type": "feedback", "when": "2018-04-19T15:47:24Z"}], "bucket_name": "Today", "history": [{"anon": "no", "uid": "hdjonbiyfs62ie", "subject": "2017春季-第十三讲课堂实践练习(4)", "created": "2017-04-10T08:15:32Z", "content": "<p>请两人一组完成“第十三讲 实验四 内核线程管理”中指定小题的回答在此贴中回复&#xff0c;每组同学选做一个数据结构分析和一个流程分析。</p>\n<p></p>\n<p>题目&#xff1a;<br /><a href=\"https://chyyuu.gitbooks.io/os_course_exercises/content/all/05-3-lab4-spoc-discussion.html\">https://chyyuu.gitbooks.io/os_course_exercises/content/all/05-3-lab4-spoc-discussion.html</a></p>\n<p></p>\n<p>视频相关思考题 -&gt; 13.3 执行流程 -&gt; 第7小题</p>\n<p></p>\n<p>分析内核线程idleproc的创建流程&#xff0c;说明线程切换后执行的第一条是什么。</p>"}], "type": "note", "tags": ["2017", "instructor-note", "lab4", "lecture13", "课堂问答"], "tag_good": [], "unique_views": 115, "children": [{"anon": "no", "folders": [], "data": {"embed_links": null}, "no_upvotes": 0, "subject": "<p>jjx</p>", "created": "2018-04-17T01:05:22Z", "bucket_order": 106, "bucket_name": "Week 4/15 - 4/21", "type": "followup", "tag_good": [], "uid": "isyhiuebva42er", "children": [{"anon": "no", "folders": [], "data": {"embed_links": null}, "subject": "<p>idle线程不是fork构造的&#xff0c;而是在proc_init中自行指定的&#xff0c;完成了和 fork类似的工作。不严格的说&#xff0c;os初始化的系列操作都可以算作idle进程。</p>\n<p></p>\n<pre>    idleproc-&gt;pid = 0;<br />    idleproc-&gt;state = PROC_RUNNABLE;<br />    idleproc-&gt;kstack = (uintptr_t)bootstack;<br />    idleproc-&gt;need_resched = 1;<br />    set_proc_name(idleproc, &#34;idle&#34;);<br />    nr_process &#43;&#43;;<br /><br />    current = idleproc;</pre>\n<p>初始化过程中不允许时钟中断的到来和中断请求的处理&#xff0c;直到必要的初始化完成。一旦允许处理时钟中断&#xff0c;cpu立刻运行cpu_idle()请求重新调度&#xff0c;idle进程让位于init进程</p>\n<p></p>\n<pre>kern_init(void) {\n    extern char edata[], end[];\n    memset(edata, 0, end - edata);\n\n    cons_init();                // init the console\n\n    const char *message = &#34;(THU.CST) os is loading ...&#34;;\n    cprintf(&#34;%s\\n\\n&#34;, message);\n\n    print_kerninfo();\n\n    grade_backtrace();\n\n    pmm_init();                 // init physical memory management\n\n    pic_init();                 // init interrupt controller\n    idt_init();                 // init interrupt descriptor table\n\n    vmm_init();                 // init virtual memory management\n    proc_init();                // init process table\n    \n    ide_init();                 // init ide devices\n    swap_init();                // init swap\n\n    clock_init();               // init clock interrupt\n    intr_enable();              // enable irq interrupt\n\n    //LAB1: CAHLLENGE 1 If you try to do it, uncomment lab1_switch_test()\n    // user/kernel mode switch test\n    //lab1_switch_test();\n    \n    cpu_idle();                 // run idle process\n}</pre>\n<p></p>", "created": "2018-04-19T15:47:24Z", "bucket_order": 106, "bucket_name": "Week 4/15 - 4/21", "type": "feedback", "tag_good": [], "uid": "isyhiuebva42er", "children": [], "tag_good_arr": [], "id": "jg6p91eym9x6or", "updated": "2018-04-19T15:47:24Z", "config": {}}], "tag_good_arr": [], "no_answer": 0, "id": "jg2yv10i3x141s", "updated": "2018-04-17T01:05:22Z", "config": {}}, {"anon": "no", "folders": [], "data": {"embed_links": null}, "no_upvotes": 0, "subject": "<p>何琦 2015011299</p>", "created": "2018-04-17T01:10:35Z", "bucket_order": 106, "bucket_name": "Week 4/15 - 4/21", "type": "followup", "tag_good": [], "uid": "je2ib3svwgf6af", "children": [{"anon": "no", "folders": [], "data": {"embed_links": null}, "subject": "<p>proc_init()</p>\n<p></p>\n<p>init hash table</p>\n<p>alloc an empty proc as idle_proc</p>\n<p>fill in necessary info</p>\n<p>&#43; pid set to 0</p>\n<p>&#43; state set to runnable</p>\n<p>&#43; kernel stack point to boot stack</p>\n<p>&#43; set reschedule flag</p>\n<p>then use idle_proc to fork init_proc</p>\n<p></p>\n<p>actually, idle_proc seems not created by fork, but &#34;rename&#34; the only running thread.</p>", "created": "2018-04-17T01:37:08Z", "bucket_order": 106, "bucket_name": "Week 4/15 - 4/21", "type": "feedback", "tag_good": [], "uid": "je2ib3svwgf6af", "children": [], "tag_good_arr": [], "id": "jg2zzw5ybro1fs", "updated": "2018-04-17T01:37:08Z", "config": {}}], "tag_good_arr": [], "no_answer": 1, "id": "jg2z1qhnlc56kh", "updated": "2018-04-17T01:10:35Z", "config": {}}, {"anon": "no", "folders": [], "data": {"embed_links": null}, "no_upvotes": 0, "subject": "<p></p>", "created": "2018-04-17T01:11:57Z", "bucket_order": 106, "bucket_name": "Week 4/15 - 4/21", "type": "followup", "tag_good": [], "uid": "i0boovu8sh63xb", "children": [], "tag_good_arr": [], "no_answer": 0, "id": "jg2z3idfhik20y", "updated": "2018-04-17T01:11:57Z", "config": {}}, {"anon": "no", "folders": [], "data": {"embed_links": null}, "no_upvotes": 0, "subject": "<p></p>\n<p>这部分的操作是从proc_init函数中开始的&#xff1a;</p>\n<p></p>\n<pre>        void proc_init(void) {\n            int i;\n            list_init(&amp;proc_list);\n            \n            for (i = 0; i &lt; HASH_LIST_SIZE; i &#43;&#43;) {                             //初始化线程/进程控制块链表与哈希表\n                list_init(hash_list &#43; i);   \n            }\n            \n            if ((idleproc = alloc_proc()) == NULL) {                            //给第一个内核线程idleproc分配线程控制块\n                panic(&#34;cannot alloc idleproc.\\n&#34;);\n            }\n\n            //完成idleproc的初始化\n            idleproc-&gt;pid = 0;                                                  //进程号设置为0\n            idleproc-&gt;state = PROC_RUNNABLE;                                    //设置进程为运行态\n            idleproc-&gt;kstack = (uintptr_t)bootstack;                            //指定idle线程的内核堆栈为bootstack栈&#xff08;当前栈&#xff09;\n            idleproc-&gt;need_resched = 1;                                         //指定idle线程需要被调度\n            set_proc_name(idleproc, &#34;idle&#34;);\n            nr_process &#43;&#43;;\n\n            current = idleproc;                                                 //当前线程正式为idle线程\n\n            //创建init线程\n            int pid = kernel_thread(init_main, &#34;Hello world!!&#34;, 0);             //通过kernel_thread创建init线程&#xff0c;让他从init_main处开始运行&#xff0c;同时输出“Hello world!&#34;\n            if (pid &lt;= 0) {\n                panic(&#34;create init_main failed.\\n&#34;);\n            }\n\n            initproc = find_proc(pid);\n            set_proc_name(initproc, &#34;init&#34;);\n\n            assert(idleproc != NULL &amp;&amp; idleproc-&gt;pid == 0);\n            assert(initproc != NULL &amp;&amp; initproc-&gt;pid == 1);\n        }</pre>\n<p>对于线程切换以后第一条执行什么我表示很疑惑&#xff0c;其实整个初始化的过程都是idle_proc在执行&#xff0c;所以很难说具体那条就是idle_proc的第一条指令&#xff0c;或者说最关键的标志什么&#xff1f;是current切换吗&#xff1f;如果是的话&#xff0c;那就应该是curr赋值语句的下一条</p>", "created": "2018-04-18T16:39:27Z", "bucket_order": 106, "bucket_name": "Week 4/15 - 4/21", "type": "followup", "tag_good": [], "uid": "isvxeq6bspf1vn", "children": [], "tag_good_arr": [], "no_answer": 1, "id": "jg5bo4wx88iqv", "updated": "2018-04-18T16:39:27Z", "config": {}}], "tag_good_arr": [], "id": "j1bufci0nvi2oc", "config": {}, "status": "active", "drafts": null, "request_instructor": 0, "request_instructor_me": false, "bookmarked": 5, "num_favorites": 0, "my_favorite": false, "is_bookmarked": false, "is_tag_good": false, "q_edits": [], "i_edits": [], "s_edits": [], "t": 1643169018562, "default_anonymity": "no"}, "error": null, "aid": "kyv0ep4yu823ts"}