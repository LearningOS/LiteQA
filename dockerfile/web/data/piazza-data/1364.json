{"result": {"folders": ["lab1"], "nr": 1364, "data": {"embed_links": []}, "created": "2019-11-02T08:46:18Z", "bucket_order": 3, "no_answer_followup": 0, "change_log": [{"anon": "no", "uid": "k2hahshrqyljh", "data": "k2hbo8nhfg967z", "type": "create", "when": "2019-11-02T08:46:18Z"}, {"anon": "no", "uid": "k2hahshrqyljh", "data": "k2hbpqp0ck94fd", "type": "update", "when": "2019-11-02T08:47:28Z"}, {"anon": "no", "uid": "k2hahshrqyljh", "data": "k2hf2aw87k14di", "to": "k2hbo8nfz4267y", "type": "s_answer", "when": "2019-11-02T10:21:13Z"}, {"anon": "no", "uid": "k2hahshrqyljh", "data": "k2hfp177drg1lx", "type": "s_answer_update", "when": "2019-11-02T10:38:53Z"}], "bucket_name": "Today", "history": [{"anon": "no", "uid": "k2hahshrqyljh", "subject": "关于在内核申请大数组导致无法触发page fault的疑问", "created": "2019-11-02T08:47:28Z", "content": "<p>写在前面&#xff1a;</p>\n<p>主要疑问以及复现的方法在 <a href=\"https://github.com/YanB25/ucore-pg-fault\">https://github.com/YanB25/ucore-pg-fault</a>  的README。</p>\n<p></p>\n<p><strong>UCORE 关于pg fault 不被触发的疑问</strong> <br /><strong>疑问简介</strong><br />在内核空间申请一个比较大的数组&#xff08;此时内核并没有突破3MB&#xff09;后&#xff0c;访问0x100地址时&#xff0c;不触发page fault.</p>\n<p></p>\n<p>按照wiki的说明&#xff0c;内核在任何时间内&#xff0c;应该拥有占据3MB大小的权利。但是当申请比较大的数组后&#xff0c;内核似乎出现了bug&#xff0c;具体表现在&#xff0c;访问一个必然缺页的地址时&#xff0c;不产生缺页异常。</p>\n<p></p>\n<p><strong>复现方法</strong> <br />本repo代码基于答案&#96;lab4_result&#96;修改而成。 <br />创建任意一个 .c 文件&#xff0c;申请一个比较大的数组。 <br />例如创建 &#96;kern/mm/cause_bug.c&#96;&#xff0c;内容为</p>\n<p></p>\n<pre>#include &lt;defs.h&gt;\n\n// #define NO_BUG 135084\n#define HAS_BUG 135085\n\n/* alloc a LONG array */\n/* END could not be larger than 0xc01b5000 */\nuint32_t array[HAS_BUG];</pre>\n<p></p>\n<p>申请长度为 135085的uint32_t数组(长度大约为0.5MB) 。 <br />此时运行 &#96;make qemu-nox&#96;&#xff0c;会有如下报错</p>\n<p></p>\n<pre>kernel panic at kern/mm/default_pmm.c:157:\nassertion failed: !PageReserved(p) &amp;&amp; !PageProperty(p)\nstack trackback:\nebp:0xc012ae78 eip:0xc0101ded args:0x0000000a 0x0000000a 0xc012aeb8 0xc012aeac\nkern/debug/kdebug.c:308: print_stackframe&#43;21\nebp:0xc012ae98 eip:0xc01017ce args:0xc010c5e7 0x0000009d 0xc010c5d2 0xc010c610\nkern/debug/panic.c:27: __panic&#43;107\nebp:0xc012af38 eip:0xc0108345 args:0xc01b6000 0x00000001 0xc012af68 0xc0104857\nkern/mm/default_pmm.c:157: default_free_pages&#43;163\nebp:0xc012af68 eip:0xc010486d args:0xc01b6000 0x00000001 0x00000002 0xc01064f5\nkern/mm/pmm.c:184: free_pages&#43;32\nebp:0xc012afa8 eip:0xc0106681 args:0x00210494 0x0021037c 0x00a011d8 0x00007c2b\nkern/mm/vmm.c:270: check_pgfault&#43;414\nebp:0xc012afc8 eip:0xc01060d2 args:0xc012b560 0x00000100 0xc012aff8 0xc0100096\nkern/mm/vmm.c:168: check_vmm&#43;23\nebp:0xc012afd8 eip:0xc01060b7 args:0x00000000 0x00000000 0x00000000 0xc010a840\nkern/mm/vmm.c:159: vmm_init&#43;10\nebp:0xc012aff8 eip:0xc0100096 args:0xc010ac98 0xc010aca0 0xc0102072 0xc010acbf\nkern/init/init.c:39: kern_init&#43;95</pre>\n<p></p>\n<p>原因是在&#96;check_pgfault&#96;运行中&#xff0c;在访问 0x100地址时&#xff0c;没有触发page fault。<br />进而导致pg_dir[0]依旧保持为空&#xff08;0x0&#xff09;&#xff0c;导致free_page(pde2page(pg_dir[0])) 企图释放0号物理页框。</p>\n<p></p>\n<p><strong>一些猜想</strong><br />是否 End 不能超过 0xc01b5000?<br />当End超过这个值后&#xff08;例如多分配一个页&#xff09;&#xff0c;达到0xc01b5020时&#xff0c;就会出现上述的错误。</p>"}, {"anon": "no", "uid": "k2hahshrqyljh", "subject": "关于在内核申请大数组导致无法触发page fault的疑问", "created": "2019-11-02T08:46:18Z", "content": "<p>写在前面&#xff1a;</p>\n<p>主要疑问以及复现的方法在 <a href=\"https://github.com/YanB25/ucore-pg-fault\">https://github.com/YanB25/ucore-pg-fault</a>  的README。</p>\n<p></p>\n<p><strong>UCORE 关于pg fault 不被触发的疑问</strong> <br /><strong>疑问简介</strong><br />在内核空间申请一个比较大的数组&#xff08;此时内核并没有突破4MB&#xff09;后&#xff0c;访问0x100地址时&#xff0c;不触发page fault.</p>\n<p></p>\n<p>按照wiki的说明&#xff0c;内核在任何时间内&#xff0c;应该拥有占据4MB大小的权利。但是当申请比较大的数组后&#xff0c;内核似乎出现了bug&#xff0c;具体表现在&#xff0c;访问一个必然缺页的地址时&#xff0c;不产生缺页异常。</p>\n<p></p>\n<p><strong>复现方法</strong> <br />本repo代码基于答案&#96;lab4_result&#96;修改而成。 <br />创建任意一个 .c 文件&#xff0c;申请一个比较大的数组。 <br />例如创建 &#96;kern/mm/cause_bug.c&#96;&#xff0c;内容为</p>\n<p></p>\n<pre>#include &lt;defs.h&gt;\n\n// #define NO_BUG 135084\n#define HAS_BUG 135085\n\n/* alloc a LONG array */\n/* END could not be larger than 0xc01b5000 */\nuint32_t array[HAS_BUG];</pre>\n<p></p>\n<p>申请长度为 135085的uint32_t数组(长度大约为0.5MB) 。 <br />此时运行 &#96;make qemu-nox&#96;&#xff0c;会有如下报错</p>\n<p></p>\n<pre>kernel panic at kern/mm/default_pmm.c:157:\nassertion failed: !PageReserved(p) &amp;&amp; !PageProperty(p)\nstack trackback:\nebp:0xc012ae78 eip:0xc0101ded args:0x0000000a 0x0000000a 0xc012aeb8 0xc012aeac\nkern/debug/kdebug.c:308: print_stackframe&#43;21\nebp:0xc012ae98 eip:0xc01017ce args:0xc010c5e7 0x0000009d 0xc010c5d2 0xc010c610\nkern/debug/panic.c:27: __panic&#43;107\nebp:0xc012af38 eip:0xc0108345 args:0xc01b6000 0x00000001 0xc012af68 0xc0104857\nkern/mm/default_pmm.c:157: default_free_pages&#43;163\nebp:0xc012af68 eip:0xc010486d args:0xc01b6000 0x00000001 0x00000002 0xc01064f5\nkern/mm/pmm.c:184: free_pages&#43;32\nebp:0xc012afa8 eip:0xc0106681 args:0x00210494 0x0021037c 0x00a011d8 0x00007c2b\nkern/mm/vmm.c:270: check_pgfault&#43;414\nebp:0xc012afc8 eip:0xc01060d2 args:0xc012b560 0x00000100 0xc012aff8 0xc0100096\nkern/mm/vmm.c:168: check_vmm&#43;23\nebp:0xc012afd8 eip:0xc01060b7 args:0x00000000 0x00000000 0x00000000 0xc010a840\nkern/mm/vmm.c:159: vmm_init&#43;10\nebp:0xc012aff8 eip:0xc0100096 args:0xc010ac98 0xc010aca0 0xc0102072 0xc010acbf\nkern/init/init.c:39: kern_init&#43;95</pre>\n<p></p>\n<p>原因是在&#96;check_pgfault&#96;运行中&#xff0c;在访问 0x100地址时&#xff0c;没有触发page fault。<br />进而导致pg_dir[0]依旧保持为空&#xff08;0x0&#xff09;&#xff0c;导致free_page(pde2page(pg_dir[0])) 企图释放0号物理页框。</p>\n<p><strong></strong></p>\n<p><strong>一些猜想</strong><br />是否 End 不能超过 0xc01b5000?<br />当End超过这个值后&#xff08;例如多分配一个页&#xff09;&#xff0c;达到0xc01b5020时&#xff0c;就会出现上述的错误。</p>"}], "type": "question", "tags": ["lab1", "student"], "tag_good": [], "unique_views": 133, "children": [{"folders": [], "data": {"embed_links": []}, "children": [], "created": "2019-11-02T10:21:13Z", "bucket_order": 3, "tag_endorse": [], "bucket_name": "Today", "id": "k2hf2aw3xnq4dh", "history": [{"anon": "no", "uid": "k2hahshrqyljh", "subject": "", "created": "2019-11-02T10:38:53Z", "content": "<p>&#xff08;我是楼主)在实验楼的环境和ubuntu的环境都无法复现。可能是环境的问题&#xff0c;这里记录一下我的环境。</p>\n<p></p>\n<pre>$ cat /etc/os-release\nNAME=&#34;Arch Linux&#34;\nPRETTY_NAME=&#34;Arch Linux&#34;\nID=arch\nBUILD_ID=rolling\nANSI_COLOR=&#34;0;36&#34;\nHOME_URL=&#34;https://www.archlinux.org/&#34;\nDOCUMENTATION_URL=&#34;https://wiki.archlinux.org/&#34;\nSUPPORT_URL=&#34;https://bbs.archlinux.org/&#34;\nBUG_REPORT_URL=&#34;https://bugs.archlinux.org/&#34;\nLOGO=archlinux</pre>\n<p></p>\n<pre>$ gcc --version\ngcc (GCC) 9.2.0\nCopyright (C) 2019 Free Software Foundation, Inc.\nThis is free software; see the source for copying conditions.  There is NO\nwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</pre>\n<p></p>\n<pre>$ qemu-system-i386 --version\nQEMU emulator version 4.1.0\nCopyright (c) 2003-2019 Fabrice Bellard and the QEMU Project developers</pre>\n<p></p>\n<pre>$ ld --version\nGNU ld (GNU Binutils) 2.32\nCopyright (C) 2019 Free Software Foundation, Inc.\nThis program is free software; you may redistribute it under the terms of\nthe GNU General Public License version 3 or (at your option) a later version.\nThis program has absolutely no warranty.</pre>\n<p></p>"}, {"anon": "no", "uid": "k2hahshrqyljh", "subject": "", "created": "2019-11-02T10:21:13Z", "content": "<p>在实验楼的环境和ubuntu的环境都无法复现。可能是环境的问题&#xff0c;这里记录一下我的环境。</p>\n<p></p>\n<pre>$ cat /etc/os-release<br />NAME=&#34;Arch Linux&#34;\nPRETTY_NAME=&#34;Arch Linux&#34;\nID=arch\nBUILD_ID=rolling\nANSI_COLOR=&#34;0;36&#34;\nHOME_URL=&#34;https://www.archlinux.org/&#34;\nDOCUMENTATION_URL=&#34;https://wiki.archlinux.org/&#34;\nSUPPORT_URL=&#34;https://bbs.archlinux.org/&#34;\nBUG_REPORT_URL=&#34;https://bugs.archlinux.org/&#34;\nLOGO=archlinux</pre>\n<p></p>\n<pre>$ gcc --version\ngcc (GCC) 9.2.0\nCopyright (C) 2019 Free Software Foundation, Inc.\nThis is free software; see the source for copying conditions.  There is NO\nwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</pre>\n<p></p>\n<pre>$ qemu-system-i386 --version<br />QEMU emulator version 4.1.0<br />Copyright (c) 2003-2019 Fabrice Bellard and the QEMU Project developers</pre>\n<p></p>\n<pre>$ ld --version<br />GNU ld (GNU Binutils) 2.32\nCopyright (C) 2019 Free Software Foundation, Inc.\nThis program is free software; you may redistribute it under the terms of\nthe GNU General Public License version 3 or (at your option) a later version.\nThis program has absolutely no warranty.</pre>\n<p></p>"}], "type": "s_answer", "tag_endorse_arr": [], "config": {}, "is_tag_endorse": false}], "tag_good_arr": [], "no_answer": 0, "id": "k2hbo8nfz4267y", "config": {}, "status": "active", "drafts": null, "request_instructor": 0, "request_instructor_me": false, "bookmarked": 1, "num_favorites": 0, "my_favorite": false, "is_bookmarked": false, "is_tag_good": false, "q_edits": [], "i_edits": [], "s_edits": [], "t": 1643169840498, "default_anonymity": "no"}, "error": null, "aid": "kyv0wbciwfjaq"}