{"result": {"history_size": 3, "folders": ["lecture7", "2017", "特权级"], "nr": 1009, "data": {"embed_links": []}, "created": "2017-03-15T00:36:47Z", "bucket_order": 3, "no_answer_followup": 0, "change_log": [{"anon": "no", "uid": "ie7xy4itft81pr", "data": "j0a8l8j2wt521q", "type": "create", "when": "2017-03-15T00:36:47Z"}, {"anon": "no", "uid": "hdjonbiyfs62ie", "data": "j0ele1b1sxg6rz", "type": "update", "when": "2017-03-18T01:46:11Z"}, {"anon": "no", "uid": "hdjonbiyfs62ie", "data": "j0eqc2ckgk394", "type": "update", "when": "2017-03-18T04:04:37Z"}, {"anon": "no", "uid": "hdjonbiyfs62ie", "data": "j0erlwsbjt363v", "to": "j0a8l8j0t0021p", "type": "i_answer", "when": "2017-03-18T04:40:16Z"}, {"anon": "no", "uid": "isy2wn7zj0u2ne", "to": "j0a8l8j0t0021p", "type": "followup", "when": "2018-03-20T02:54:06Z"}, {"anon": "no", "uid": "it2wrxu13f13sy", "to": "j0a8l8j0t0021p", "type": "feedback", "when": "2018-03-20T05:55:07Z"}], "bucket_name": "Today", "history": [{"anon": "no", "uid": "hdjonbiyfs62ie", "subject": "关于x-86访问时特权级的问题", "created": "2017-03-18T04:04:37Z", "content": "<p>课件上写到访问门时要求CPL &lt;= DPL(门)&amp; CPL&gt;= DPL(段),但陈老师上课的时候提到门的作用是让低特权级的有可能访问到高特权级&#xff0c;而段的作用是高特权级进行检查和保护。<br />这样理解的话访问门时应是CPL &gt;= DPL(门&#xff09;&amp; CPL &lt;= DPL(段&#xff09;&#xff0c;即访问门时特权较低&#xff0c;然后段检查时要求特权较高&#xff0c;与课件中所示矛盾&#xff1f;</p>"}, {"anon": "no", "uid": "hdjonbiyfs62ie", "subject": "关于x-86访问时特权级的问题", "created": "2017-03-18T01:46:11Z", "content": "<p>课件上写到访问门时要求CPL &lt;= DPL(门)&amp; CPL&gt;= DPL(段),但陈老师上课的时候提到门的作用是让低特权级的有可能访问到高特权级&#xff0c;而段的作用是高特权级进行检查和保护。<br />这样理解的话访问门时应是CPL &gt;= DPL(门&#xff09;&amp; CPL &lt;= DPL(段&#xff09;&#xff0c;即访问门时特权较低&#xff0c;然后段检查时要求特权较高&#xff0c;与课件中所示矛盾&#xff1f;</p>"}, {"anon": "no", "uid": "ie7xy4itft81pr", "subject": "关于x-86访问时特权级的问题", "created": "2017-03-15T00:36:47Z", "content": "课件上写到访问门时要求CPL &lt;= DPL(门)&amp; CPL&gt;= DPL(段),但陈老师上课的时候提到门的作用是让低特权级的有可能访问到高特权级&#xff0c;而段的作用是高特权级进行检查和保护。\n这样理解的话访问门时应是CPL &gt;= DPL(门&#xff09;&amp; CPL &lt;= DPL(段&#xff09;&#xff0c;即访问门时特权较低&#xff0c;然后段检查时要求特权较高&#xff0c;与课件中所示矛盾&#xff1f;"}], "type": "question", "tags": ["2017", "lecture7", "student", "特权级"], "tag_good": [], "unique_views": 138, "children": [{"history_size": 1, "folders": [], "data": {"embed_links": []}, "created": "2017-03-18T04:40:16Z", "bucket_order": 3, "tag_endorse": [], "bucket_name": "Today", "history": [{"anon": "no", "uid": "hdjonbiyfs62ie", "subject": "", "created": "2017-03-18T04:40:16Z", "content": "<p>先回答同学的问题&#xff0c;这里是不矛盾的&#xff0c;这两个条件不会同时检查。通过门访问时&#xff0c;会先有一个栈切换。栈切换时&#xff0c;特权级已经变了。</p>\n<p></p>\n<p>X86的特权级是同学们在学习操作系统&#xff0c;特别是在做实验时遇到的一个大问题。经常是好像搞明白了&#xff0c;但又似懂非懂。于是&#xff0c;把相关的一些问答帖子清理了一下&#xff0c;给出下面的汇总。供同学们参考。</p>\n<p></p>\n<p>下面帖子是关于特权级问题中&#xff0c;就iret执行过程中特权级判断和切换的最清楚分析&#xff08;至少目前是最清楚的&#xff09;。我再表扬一次。<br /><a href=\"https://www.piazza.com/class/i5j09fnsl7k5x0?cid=691\">https://piazza.com/class/i5j09fnsl7k5x0?cid=691</a></p>\n<p>特权级切换时iret的准确过程&#xff08;课上提问&#xff09;</p>\n<p></p>\n<p>首先需要讨论的特权级的概念。我们通常讨论时说的cpl, rpl和dpl已把大家搞得有些晕了&#xff0c;细看下去会遇到下面的一些名词CPL, RPL, DPL, gate dpl, DPL of the segment descriptor, IOPL等。下面是Intel手册&#xff08;这里特指 <a href=\"http://os.cs.tsinghua.edu.cn/oscourse/OS2017spring/lecture04#X86_CPU.2BYktRjA-\">http://os.cs.tsinghua.edu.cn/oscourse/OS2017spring/lecture04#X86_CPU.2BYktRjA-</a> 处的4684页手册&#xff09;中就这些名词的准确定义&#xff0c;但它们并不通俗。希望同学们在本贴后面回复你对这些名词的理解&#xff0c;从而得到一个适合初学操作系统课的同学的定义。</p>\n<p></p>\n<p>Page 152/4684:</p>\n<p>6.3.5 Calls to Other Privilege Levels<br />Figure 6-3. Protection Rings Page 2817/4684: 5.5 PRIVILEGE LEVELS<br />Figure 5-3. Protection Rings<br />这里给出了CPL、RPL和DPL的准确定义。 </p>\n<p></p>\n<p>Page 79/4684:<br />3.4.3.3 System Flags and IOPL Field<br />IOPL (bits 12 and 13) I/O privilege level field — Indicates the I/O privilege level of the currently running program or task. The current privilege level (CPL) of the currently running program or task must be less than or equal to the I/O privilege level to access the I/O address space.<br />这是IOPL的准确定义。</p>\n<p></p>\n<p>Page 406/4684:</p>\n<p>18.5.1 I/O Privilege Level<br />In a typical protection ring model, access to the I/O address space is restricted to privilege levels 0 and 1.</p>\n<p></p>\n<p>第二个问题是执行指令时的特权级判断条件问题。最简洁的表述是下面的不等式&#xff0c;前半段说通常指令执行时的特权级判断&#xff0c;当前进程只能访问特权级比自己大的代码和数据&#xff1b;后关段说int指令执行&#xff0c;用户可以使用特权级比自己小的操作系统服务。这个表达式出现在早的intel手册中&#xff0c;2016年的手册中没有了&#xff08;可参见下面链接 <a href=\"http://www.cnblogs.com/coryxie/p/3967425.html\">http://www.cnblogs.com/coryxie/p/3967425.html</a> &#xff09;。</p>\n<p></p>\n<p>target dpl &lt;= max(cpl, rpl) &lt;= gate dpl</p>\n<p></p>\n<p>下面两处分别是intel手册中对这两个判断的准确描述&#xff0c;插图应该是很直观的。当然&#xff0c;它们也还不够通俗。希望同学们在本贴后面回复你的理解。</p>\n<p></p>\n<p>Page 2819/4684:</p>\n<p>5.6 PRIVILEGE LEVEL CHECKING WHEN ACCESSING DATA SEGMENTS<br />Figure 5-4. Privilege Check for Data Access<br />这个图清楚地给出数据访问时的特权级判断条件&#xff1a;max(cpl, rpl)&lt;=dpl。</p>\n<p></p>\n<p>Page 2827/4684:<br />Figure 5-12. Example of Accessing Call Gates At Various Privilege Levels<br />这个图对应的解释文字中“in Figure 5-15”应该是“in Figure 5-12”。这个图清楚地给出了通过门访问门的特权级判断条件&#xff1a;<br />cpl=rpl, cpl &lt;= gate dpl</p>\n<p></p>\n<p>希望能引起同学们对这个问题的讨论兴趣。</p>"}], "type": "i_answer", "tag_endorse_arr": [], "children": [], "id": "j0erlws8yr763u", "config": {}, "is_tag_endorse": false}, {"anon": "no", "folders": [], "data": {"embed_links": null}, "no_upvotes": 0, "subject": "<p>关于上面提到的最后一点&#xff0c;即“Example of Accessing Call Gates At Various Privilege Levels”&#xff0c;对应于PPT中“x86访问门时的特权级&#xff1a;CPL &lt;= DPL[门] &amp; CPL &gt;= DPL[段]”&#xff0c;我的理解如下&#xff1a;</p>\n<p></p>\n<p>首先手册中Table 5-1给出了访问门时的特权级检查规则&#xff08;此处仅考虑使用call而非jmp&#xff09;&#xff1a;</p>\n<p><img src=\"/img/1009-1bf680c284e63a9e.png\" alt=\"访问门时的特权级检查规则\" /></p>\n<p></p>\n<p>可以看到&#xff0c;对于DPL有两个概念需要区分&#xff1a;其一是门本身的gate DPL&#xff0c;其二是门对应的目标代码段的code segment DPL. 此外&#xff0c;这里还有两个名词需要解释&#xff1a;</p>\n<ul><li>conforming code segment&#xff1a;一致代码段&#xff0c;可以被低特权级的用户直接调用访问的代码&#xff0c;但是特权级不会改变&#xff0c;用户态还是用户态</li><li>nonconforming code segment&#xff1a;非一致代码段&#xff0c;只允许同级间访问&#xff0c;绝对禁止不同级访问</li></ul>\n<p></p>\n<p>这样就可以理解PPT中提到的“CPL &lt;= DPL[门] &amp; CPL &gt;= DPL[段]”的含义如下&#xff1a;</p>\n<ul><li>对于第一条“CPL &lt;= DPL[门]”&#xff0c;对应的是Table 5-1中第一条条件&#xff0c;即门本身是可以在当前特权级下被访问到的</li><li>对于第二条“CPL &gt;= DPL[段]”&#xff0c;对应的是Table 5-1中第二条条件&#xff0c;即门对应的目标代码段&#xff08;可以理解为门指向的中断服务例程代码&#xff09;所满足的条件&#xff0c;也就是要求目标代码的DPL不大于当前特权级&#xff1b;这一点很好理解&#xff0c;因为目标代码段一般为核心代码&#xff0c;其本身的DPL为核心等级&#xff0c;但存在处于用户态的进程需要执行这些代码的需求&#xff08;如系统调用&#xff09;&#xff0c;因此允许目标代码DPL小于CPL的情况出现。但针对代码段是conforming还是nonconforming&#xff0c;会涉及到是否要变更CPL</li></ul>\n<p></p>\n<p>下面举出手册中的例子。作为例子的Figure 5-12如下&#xff1a;</p>\n<p><img src=\"/img/1009-807e8a954b6abfa2.png\" alt=\"不同特权级访问门的例子\" /></p>\n<p></p>\n<p></p>\n<p>仅以在ring 3访问Gate A为例&#xff1a;</p>\n<ul><li>当前处于用户态的代码段A&#xff0c;CPL=3</li><li>通过Gate Selector A以RPL=3访问门A&#xff0c;门A的DPL=3&#xff0c;这满足Table 5-1的第一条检查条件&#xff0c;即“CPL &lt;= call gate DPL, RPL &lt;= call gate DPL”</li><li>在满足上面的条件后&#xff0c;则可以跳转并执行门A对应的核心态代码段E&#xff08;可以理解为门A对应的中断服务例程&#xff09;&#xff0c;代码段E的DPL=0&#xff0c;小于CPL&#xff0c;对于call gate而言这是允许的&#xff0c;满足Table 5-1的第二条检查条件</li><li>由于代码段E是nonconforming code segment&#xff0c;所以会要求CPL的特权级变更&#xff08;需要变为代码段E的同级即ring 0&#xff09;&#xff0c;因而会导致stack switch&#xff08;作为对比&#xff0c;访问代码段D时不需要stack switch&#xff09;</li></ul>\n<p></p>\n<p>&#xff08;参考&#xff1a;Intel® 64 and IA-32 Architectures Software Developer’s Manual 第5.8.4节 Accessing a Code Segment Through a Call Gate&#xff09;</p>", "created": "2018-03-20T02:54:06Z", "bucket_order": 148, "bucket_name": "Week 3/18 - 3/24", "type": "followup", "tag_good": [{"role": "student", "name": "Yifei Li", "endorser": {}, "admin": false, "photo": null, "id": "jvwis9vjc9t6d3", "photo_url": null, "published": true, "us": false, "facebook_id": null}], "uid": "isy2wn7zj0u2ne", "children": [{"anon": "no", "folders": [], "data": {"embed_links": null}, "subject": "<p>赞&#xff01;</p>", "created": "2018-03-20T05:55:07Z", "bucket_order": 148, "bucket_name": "Week 3/18 - 3/24", "type": "feedback", "tag_good": [], "uid": "it2wrxu13f13sy", "children": [], "tag_good_arr": [], "id": "jez8vszh67y5kp", "updated": "2018-03-20T05:55:07Z", "config": {}}], "tag_good_arr": ["jvwis9vjc9t6d3"], "no_answer": 0, "id": "jez2f0gnza11op", "updated": "2018-03-20T02:54:06Z", "config": {}}], "tag_good_arr": [], "no_answer": 0, "id": "j0a8l8j0t0021p", "config": {}, "status": "active", "drafts": null, "request_instructor": 0, "request_instructor_me": false, "bookmarked": 10, "num_favorites": 1, "my_favorite": false, "is_bookmarked": false, "is_tag_good": false, "q_edits": [], "i_edits": [], "s_edits": [], "t": 1643168971511, "default_anonymity": "no"}, "error": null, "aid": "kyv0dotzsv6wi"}