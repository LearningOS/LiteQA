{"result": {"folders": ["big_proj", "2016", "特权级"], "nr": 218, "data": {"embed_links": []}, "created": "2015-03-31T13:26:43Z", "bucket_order": 3, "no_answer_followup": 0, "change_log": [{"uid": "i6un8w0cKfP", "anon": "no", "when": "2015-03-31T13:26:43Z", "data": "i7xc9asjqvy5xu", "type": "create"}, {"uid": "i6un8w0cKfP", "anon": "no", "when": "2015-03-31T13:50:26Z", "data": "i7xd3sw6qcx7nk", "type": "update"}, {"to": "i7xc9ashjl65xt", "uid": "i6un8w0cKfP", "anon": "no", "when": "2015-03-31T13:58:43Z", "data": "i7xdegcyg2x30t", "type": "s_answer"}, {"uid": "i6un8w0cKfP", "anon": "no", "when": "2015-03-31T13:59:01Z", "data": "i7xdeu4pn7f365", "type": "s_answer_update"}, {"uid": "i6un8w0cKfP", "anon": "no", "when": "2015-03-31T14:09:52Z", "data": "i7xdssxqe846ef", "type": "s_answer_update"}, {"anon": "full", "when": "2015-03-31T14:13:33Z", "data": "i7xdxjm467onk", "type": "s_answer_update", "uid_a": "a_0"}, {"to": "i7xc9ashjl65xt", "anon": "full", "when": "2015-03-31T14:13:51Z", "type": "followup", "uid_a": "a_0"}, {"to": "i7xc9ashjl65xt", "uid": "i6uqzf449em3ex", "anon": "no", "when": "2015-03-31T17:40:25Z", "type": "followup"}, {"to": "i7xc9ashjl65xt", "uid": "hcrrjuyequh4bt", "anon": "no", "when": "2015-04-01T01:32:23Z", "type": "followup"}, {"to": "i7xc9ashjl65xt", "uid": "hdjoucuyb836fq", "anon": "no", "when": "2015-04-01T02:38:41Z", "data": "i7y4jrvayk82lt", "type": "i_answer"}, {"uid": "hdjoucuyb836fq", "anon": "no", "when": "2015-04-01T02:58:21Z", "data": "i7y592ghm2b3o7", "type": "i_answer_update"}, {"uid": "hdjoucuyb836fq", "anon": "no", "when": "2015-04-01T02:59:32Z", "data": "i7y5alkw5kf1mk", "type": "i_answer_update"}, {"uid": "hsfa0sawctb6v4", "anon": "no", "when": "2015-04-01T03:04:34Z", "data": "i7y5h2dktlb1ub", "type": "i_answer_update"}, {"to": "i7xc9ashjl65xt", "anon": "full", "when": "2015-04-01T12:54:07Z", "type": "feedback", "uid_a": "a_0"}, {"to": "i7xc9ashjl65xt", "uid": "i6un8w0cKfP", "anon": "no", "when": "2015-04-01T13:00:35Z", "type": "feedback"}, {"to": "i7xc9ashjl65xt", "uid": "i6un8w0cKfP", "anon": "no", "when": "2015-04-01T13:01:11Z", "type": "feedback"}, {"uid": "hs2sszxmgag6jq", "anon": "no", "when": "2015-04-07T07:45:06Z", "data": "i8704yh3who51q", "type": "update"}, {"uid": "hs2sszxmgag6jq", "anon": "no", "when": "2015-04-07T08:03:33Z", "data": "i870so8truy2do", "type": "update"}, {"anon": "no", "uid": "hdjonbiyfs62ie", "data": "j0eli7362v8hd", "type": "update", "when": "2017-03-18T01:49:25Z"}, {"anon": "no", "uid": "hdjonbiyfs62ie", "data": "j0eqfg4br1366n", "type": "update", "when": "2017-03-18T04:07:15Z"}], "bucket_name": "Today", "history": [{"anon": "no", "uid": "hdjonbiyfs62ie", "subject": "iret在什么情况下会把%gs变成0&#xff1f;", "created": "2017-03-18T04:07:15Z", "content": "<p>我以为没人会动这玩意结果调了一天。。</p>"}, {"anon": "no", "uid": "hdjonbiyfs62ie", "subject": "iret在什么情况下会把%gs变成0&#xff1f;", "created": "2017-03-18T01:49:25Z", "content": "<p>我以为没人会动这玩意结果调了一天。。</p>"}, {"anon": "no", "uid": "hs2sszxmgag6jq", "subject": "iret在什么情况下会把%gs变成0&#xff1f;", "created": "2015-04-07T08:03:33Z", "content": "<p>我以为没人会动这玩意结果调了一天。。</p>"}, {"anon": "no", "uid": "hs2sszxmgag6jq", "subject": "iret在什么情况下会把%gs变成0&#xff1f;", "created": "2015-04-07T07:45:06Z", "content": "<p>我以为没人会动这玩意结果调了一天。。</p>\n#pin"}, {"anon": "no", "uid": "i6un8w0cKfP", "subject": "iret在什么情况下会把%gs变成0&#xff1f;", "created": "2015-03-31T13:50:26Z", "content": "<p>我以为没人会动这玩意结果调了一天。。</p>"}, {"anon": "no", "uid": "i6un8w0cKfP", "subject": "iret在什么情况下会把%gs变成0&#xff1f;", "created": "2015-03-31T13:26:43Z", "content": "<p>如题所问 搜索未果</p>"}], "type": "question", "tags": ["2016", "big_proj", "student", "特权级"], "tag_good": [], "unique_views": 104, "children": [{"folders": [], "data": {"embed_links": []}, "children": [], "created": "2015-03-31T13:58:43Z", "bucket_order": 3, "tag_endorse": [], "bucket_name": "Today", "id": "i7xdegb3ywa30s", "history": [{"anon": "full", "uid_a": "a_0", "subject": "", "created": "2015-03-31T14:13:33Z", "content": "<p></p>"}, {"anon": "no", "uid": "i6un8w0cKfP", "subject": "", "created": "2015-03-31T14:09:52Z", "content": "<p>这个也许有帮助</p>\n<p><a href=\"http://osdir.com/ml/qemu-devel/2010-03/msg01830.html\" target=\"_blank\">http://osdir.com/ml/qemu-devel/2010-03/msg01830.html</a></p>"}, {"anon": "no", "uid": "i6un8w0cKfP", "subject": "", "created": "2015-03-31T13:59:01Z", "content": "<p>然后我发现了这个</p>\n<p><a href=\"http://osdir.com/ml/qemu-devel/2010-03/msg01830.html\" target=\"_blank\">http://osdir.com/ml/qemu-devel/2010-03/msg01830.html</a></p>"}, {"anon": "no", "uid": "i6un8w0cKfP", "subject": "", "created": "2015-03-31T13:58:43Z", "content": "<p>然后我发现了这个</p>\n<p>http://osdir.com/ml/qemu-devel/2010-03/msg01830.html</p>"}], "type": "s_answer", "tag_endorse_arr": [], "config": {}, "is_tag_endorse": false}, {"anon": "full", "folders": [], "data": {"embed_links": null}, "no_upvotes": 0, "subject": "<p>这个也许有帮助</p>\n<p><a href=\"http://osdir.com/ml/qemu-devel/2010-03/msg01830.html\">http://osdir.com/ml/qemu-devel/2010-03/msg01830.html</a><a href=\"http://osdir.com/ml/qemu-devel/2010-03/msg01830.html\" target=\"_blank\"></a></p>\n<p>似乎确实是会清的</p>\n<p>我仍然不明白它闲着没事清俩寄存器有什么作用</p>", "created": "2015-03-31T14:13:51Z", "bucket_order": 278, "bucket_name": "Week 3/29 - 4/4", "type": "followup", "tag_good": [], "uid_a": "a_0", "children": [], "tag_good_arr": [], "no_answer": 0, "id": "i7xdxx0qux81tt", "updated": "2015-03-31T14:13:51Z", "config": {}}, {"anon": "no", "folders": [], "data": {"embed_links": null}, "no_upvotes": 0, "subject": "<p>不是iret清零的吧&#xff0c;是那个popl %gs吧&#xff1f;</p>", "created": "2015-03-31T17:40:25Z", "bucket_order": 278, "bucket_name": "Week 3/29 - 4/4", "type": "followup", "tag_good": [], "uid": "i6uqzf449em3ex", "children": [{"anon": "full", "folders": [], "data": {"embed_links": null}, "subject": "<p>确实是iret清的 我以为设了tf_gs就没事了 结果调死我了 单步了一晚上才发现</p>", "created": "2015-04-01T12:54:07Z", "bucket_order": 278, "bucket_name": "Week 3/29 - 4/4", "type": "feedback", "tag_good": [], "uid_a": "a_0", "children": [], "tag_good_arr": [], "id": "i7yqj8pwgfnow", "updated": "2015-04-01T12:54:07Z", "config": {}}, {"anon": "no", "folders": [], "data": {"embed_links": null}, "subject": "<p>不小心匿名了。。</p>\n<p>前面那个pop %gs带有强烈的误导性&#xff0c;一个会被iret修改的东西不需要push再pop&#xff0c;所以我根本没怀疑过iret会动这玩意。现在看来是qemu写错了&#xff0c;气死我了。。</p>", "created": "2015-04-01T13:01:11Z", "bucket_order": 278, "bucket_name": "Week 3/29 - 4/4", "type": "feedback", "tag_good": [], "uid": "i6un8w0cKfP", "children": [], "tag_good_arr": [], "id": "i7yqsbk62jlwk", "updated": "2015-04-01T13:01:11Z", "config": {}}], "tag_good_arr": [], "no_answer": 0, "id": "i7xlbkn6r153ht", "updated": "2015-03-31T17:40:25Z", "config": {}}, {"anon": "no", "folders": [], "data": {"embed_links": null}, "no_upvotes": 0, "subject": "<p>iret 会根据 kernel stack返回到内核空间和用户空间&#xff0c;并修改部分寄存器&#xff0c;但不包括GS.</p>\n<p>你在哪段代码调试中发现了这个问题?</p>\n<p>你的代码放在哪里? 我想看看。</p>\n<p>你的qemu的版本是?</p>", "created": "2015-04-01T01:32:23Z", "bucket_order": 278, "bucket_name": "Week 3/29 - 4/4", "type": "followup", "tag_good": [], "uid": "hcrrjuyequh4bt", "children": [{"anon": "no", "folders": [], "data": {"embed_links": null}, "subject": "<p>你在哪段代码调试中发现了这个问题?</p>\n<p>我在iret回用户程序之后会莫名其妙的崩溃&#xff0c;经过调试发现&#xff05;gs变成0了&#xff0c;单步后发现被iret清了&#xff0c;只有在ring0到3外加一些条件才会发生。</p>\n<p>我原以为iret不会修改gs&#xff0c;用户程序也不能修改段寄存器&#xff0c;所以直接在trapframe中设定gs&#xff0c;以为这个量可以留住。</p>\n<p>你的代码放在哪里? 我想看看。</p>\n<p><a href=\"https://github.com/glglwty/ucore_lab/tree/a61a5a5603dd7b9940ddc08bbc35c0ac0d315038\">https://github.com/glglwty/ucore_lab/tree/a61a5a5603dd7b9940ddc08bbc35c0ac0d315038</a></p>\n<p>断点设定在trapentry.S的trapret&#xff0c;pop %gs后查看gs正常&#xff0c;iret执行后立刻变成0。</p>\n<div>\n<div>\n<p>你的qemu的版本是?</p>\n</div>\n</div>\n<div>\n<div>\n<div>\n<div>QEMU emulator version 2.1.0 (Debian 2.1&#43;dfsg-4ubuntu6.4), Copyright (c) 2003-2008 Fabrice Bellard</div>\n</div>\n</div>\n</div>", "created": "2015-04-01T13:00:35Z", "bucket_order": 278, "bucket_name": "Week 3/29 - 4/4", "type": "feedback", "tag_good": [], "uid": "i6un8w0cKfP", "children": [], "tag_good_arr": [], "id": "i7yqrk1k9ymgg", "updated": "2015-04-01T13:00:35Z", "config": {}}], "tag_good_arr": [], "no_answer": 0, "id": "i7y26ik8ewsbh", "updated": "2015-04-01T01:32:23Z", "config": {}}, {"folders": [], "data": {"embed_links": []}, "children": [], "created": "2015-04-01T02:38:41Z", "bucket_order": 3, "tag_endorse": [], "bucket_name": "Today", "id": "i7y4jrv8w0r2ls", "history": [{"anon": "no", "uid": "hsfa0sawctb6v4", "subject": "", "created": "2015-04-01T03:04:34Z", "content": "<p>x86手册中iret的定义没有修改gs的可能&#xff0c;但是在qemu里执行在iret时&#xff0c;如果以下条件同时成立&#xff1a;</p>\n<ul><li>GS的高13位非0&#xff1b;</li><li>GS是数据段&#xff08;type域最高位为0&#xff09;&#xff1b;</li><li>GS对应段的dpl小于cpl&#xff08;比如回用户态时&#xff09;。\n<ul></ul>\n</li></ul>\n<p>那么GS会被清成0&#xff08;理由不明&#xff09;。</p>\n<p></p>\n<p>一种workaround是在用户进程进入内核时恢复gs&#xff0c;这个gs可以保存在进程的PCB里。</p>\n<p></p>\n<p>把GS所指的描述符的DPL设成3&#xff0c;应该就没有问题了</p>"}, {"anon": "no", "uid": "hdjoucuyb836fq", "subject": "", "created": "2015-04-01T02:59:32Z", "content": "<p>x86手册中iret的定义没有修改gs的可能&#xff0c;但是在qemu里执行在iret时&#xff0c;如果以下条件同时成立&#xff1a;</p>\n<ul><li>GS的高13位非0&#xff1b;</li><li>GS是数据段&#xff08;type域最高位为0&#xff09;&#xff1b;</li><li>GS对应段的dpl小于cpl&#xff08;比如回用户态时&#xff09;。\n<ul></ul>\n</li></ul>\n<p>那么GS会被清成0&#xff08;理由不明&#xff09;。</p>\n<p></p>\n<p>一种workaround是在用户进程进入内核时恢复gs&#xff0c;这个gs可以保存在进程的PCB里。</p>"}, {"anon": "no", "uid": "hdjoucuyb836fq", "subject": "", "created": "2015-04-01T02:58:21Z", "content": "<p>这个是qemu的行为&#xff0c;在iret时&#xff0c;如果以下条件同时成立&#xff1a;</p>\n<ul><li>GS的高13位非0&#xff1b;</li><li>GS是数据段&#xff08;type域最高位为0&#xff09;&#xff1b;</li><li>GS对应段的dpl小于cpl&#xff08;比如回用户态时&#xff09;。\n<ul></ul>\n</li></ul>\n<p>那么GS会被清成0。</p>\n<p></p>\n<p>一种workaround是在用户进程进入内核时恢复gs&#xff0c;这个gs可以保存在进程的PCB里。</p>"}, {"anon": "no", "uid": "hdjoucuyb836fq", "subject": "", "created": "2015-04-01T02:38:41Z", "content": "<p>请试一下把gs对应段的权限从USER_DS改成KERNEL_DS。</p>"}], "type": "i_answer", "tag_endorse_arr": [], "config": {}, "is_tag_endorse": false}], "tag_good_arr": [], "no_answer": 0, "id": "i7xc9ashjl65xt", "config": {}, "status": "active", "drafts": null, "request_instructor": 0, "request_instructor_me": false, "bookmarked": 9, "num_favorites": 0, "my_favorite": false, "is_bookmarked": false, "is_tag_good": false, "q_edits": [], "i_edits": [], "s_edits": [], "t": 1643167491923, "default_anonymity": "no"}, "error": null, "aid": "kyuzhz6bt5d4ma"}