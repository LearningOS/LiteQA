{"result": {"folders": ["quiz7"], "nr": 164, "data": {"embed_links": []}, "created": "2015-03-24T05:00:58Z", "bucket_order": 3, "no_answer_followup": 0, "change_log": [{"uid": "i6rtbanwzcm5t6", "anon": "no", "when": "2015-03-24T05:00:58Z", "data": "i7mu3ybx7gu1mw", "type": "create"}, {"to": "i7mu3ybuqc31mv", "uid": "hdjoucuyb836fq", "anon": "no", "when": "2015-03-24T05:45:13Z", "data": "i7mvoum2osyuv", "type": "i_answer"}, {"to": "i7mu3ybuqc31mv", "uid": "hcrrjuyequh4bt", "anon": "no", "when": "2015-03-24T09:35:45Z", "type": "followup"}], "bucket_name": "Today", "history": [{"anon": "no", "uid": "i6rtbanwzcm5t6", "subject": "关于TSS和中断时保存状态的栈的问题", "created": "2015-03-24T05:00:58Z", "content": "<p>我现在是这样认为的&#xff0c;ring0状态出现中断&#xff0c;保存现场时会把相关寄存器的值存入ring0自己的一个栈里&#xff0c;处理完直接恢复&#xff1b;</p>\n<p>ring3状态出现中断时&#xff0c;保存现场也会把相关寄存器的值存入ring3自己的一个栈里&#xff0c;然后转换为ring0处理中断&#xff0c;此时ring0中的栈也会保存转换前ring3状态的一些寄存器&#xff0c;以便能跳回ring3&#xff0c;所以这里<strong>涉及到两个栈</strong>&#xff0c;所以如果要达到转换特权级的效果&#xff0c;ring3转换为ring0特权级&#xff0c;需要在ring3发出一个软中断&#xff0c;并且在跳回前修改ring0级的那个栈&#xff0c;<strong>即第二个栈</strong>&#xff0c;让它类似第一种情况一样当作ring0自己的中断进行返回。</p>\n<p>&#xff08;我不知道我这里理解得准不准确&#xff0c;希望老师同学们予以修正&#xff5e;&#xff09;</p>\n<p>但是我不清楚这里所说的栈是指什么&#xff1f;跟TSS有什么区别&#xff1f;我做练习时&#xff0c;发现TSS的功能是&#xff1a;</p>\n<p>  保存ring 0的SS    保存ring 0的ESP</p>\n<p></p>\n<p>那么如果ring0里那个栈是指TSS&#xff0c;ring3下的那个栈又是指什么呢&#xff1f;还是说两个特权级都有自己的TSS?</p>"}], "type": "question", "tags": ["quiz7", "student"], "tag_good": [], "unique_views": 96, "children": [{"folders": [], "data": {"embed_links": []}, "children": [], "created": "2015-03-24T05:45:13Z", "bucket_order": 3, "tag_endorse": [{"role": "", "name": "陈振寰", "endorser": {}, "admin": false, "photo": "1425297841_35.png", "id": "i6rtbanwzcm5t6", "photo_url": "https://d1b10bmlvqabco.cloudfront.net/photos/i6rtbanwzcm5t6/1425297841_35.png", "published": true, "us": false, "class_sections": ["清华学生_i5j09fnsl7k5x0"], "facebook_id": null}], "bucket_name": "Today", "id": "i7mvouls5zwuu", "history": [{"anon": "no", "uid": "hdjoucuyb836fq", "subject": "", "created": "2015-03-24T05:45:13Z", "content": "<p>以下是Intel系统开发手册&#xff08;Software Developer&#39;s Manual&#xff0c;简称SDM&#xff09;里的描述&#xff08;参见第三卷的6.12.1节&#xff09;&#xff1a;</p>\n<pre>• If the handler procedure is going to be executed at a numerically lower privilege level, a stack switch occurs. When the stack switch occurs:\na. The segment selector and stack pointer for the stack to be used by the handler are obtained from the TSS for the currently executing task. On this new stack, the processor pushes the stack segment selector and stack pointer of the interrupted procedure.\nb. The processor then saves the current state of the EFLAGS, CS, and EIP registers on the new stack (see Figures 6-4).\nc. If an exception causes an error code to be saved, it is pushed on the new stack after the EIP value.</pre>\n<p></p>\n<p>也就是说&#xff1a;</p>\n<ul><li>ring0和ring3需要两个栈&#xff1b;</li><li>在ring3发生中断进入ring0时&#xff0c;首先进行栈的切换&#xff0c;上下文&#xff08;ss, esp, eflags, cs, eip等&#xff09;放在ring0的栈&#xff1b;</li><li>TSS的用途是在上述中断发生时&#xff0c;CPU有办法知道ring0的栈在什么位置。</li></ul>\n<p></p>\n<p>TSS实际上就是一块内存&#xff0c;CPU规定了TSS里应该存放什么东西&#xff0c;其中就包括ring3通过中断进入ring0时需要更换的栈的位置。就像cs对应的GDT表项里存放了代码段的基地址一样&#xff0c;TSS的起始地址也存放在一条GDT表项中&#xff0c;指定哪一个表项是TSS表项的是task register&#xff0c;存取task register有专用的指令ltr和str。相关内容可以参考SDM第三卷的7.2节。</p>"}], "type": "i_answer", "tag_endorse_arr": ["i6rtbanwzcm5t6"], "config": {}, "is_tag_endorse": false}, {"anon": "no", "folders": [], "data": {"embed_links": null}, "no_upvotes": 0, "subject": "<p>我记得如果要从ring0到ring3,是通过重构在ring0的stack的内容后&#xff0c;通过iret完成特权级切换。而从ring3到ring0&#xff0c;是通过执行系统调用 &#xff08;如int 0x80&#xff09;来完成的。</p>\n<p>ring3状态出现中断时&#xff0c;CPU把将来用于部分线程寄存器保存在ring0的堆栈中&#xff08;其堆栈地址通过读取TSS的SS0&#xff0c; ESP0来完成&#xff09;。</p>\n<p>没有两个TSS</p>", "created": "2015-03-24T09:35:45Z", "bucket_order": 265, "bucket_name": "Week 3/22 - 3/28", "type": "followup", "tag_good": [], "uid": "hcrrjuyequh4bt", "children": [], "tag_good_arr": [], "no_answer": 0, "id": "i7n3xbdfeub2o3", "updated": "2015-03-24T09:35:45Z", "config": {}}], "tag_good_arr": [], "no_answer": 0, "id": "i7mu3ybuqc31mv", "config": {}, "status": "active", "drafts": null, "request_instructor": 0, "request_instructor_me": false, "bookmarked": 4, "num_favorites": 2, "my_favorite": false, "is_bookmarked": false, "is_tag_good": false, "q_edits": [], "i_edits": [], "s_edits": [], "t": 1643167410734, "default_anonymity": "no"}, "error": null, "aid": "kyuzg8j2jdn4oo"}