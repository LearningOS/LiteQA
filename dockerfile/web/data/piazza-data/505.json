{"result": {"folders": ["ucore_plus"], "nr": 505, "data": {"embed_links": []}, "created": "2015-08-28T09:58:27Z", "bucket_order": 3, "no_answer_followup": 0, "change_log": [{"uid": "i6ry30g7v1z", "anon": "no", "when": "2015-08-28T09:58:27Z", "data": "idvgv8zz4su1y9", "type": "create"}, {"uid": "i6ry30g7v1z", "anon": "no", "when": "2015-08-28T10:02:15Z", "data": "idvh04mfv7g560", "type": "update"}, {"uid": "i6ry30g7v1z", "anon": "no", "when": "2015-08-28T10:03:58Z", "data": "idvh2cmm1bp53u", "type": "update"}, {"uid": "i6ry30g7v1z", "anon": "no", "when": "2015-08-28T15:46:04Z", "data": "idvtaa71xdb3wi", "type": "update"}, {"to": "idvgv8zwxt61y8", "uid": "hdjonbiyfs62ie", "anon": "no", "when": "2015-09-12T05:56:22Z", "data": "iegntpjwxwc2sv", "type": "i_answer"}, {"to": "idvgv8zwxt61y8", "uid": "i6ry30g7v1z", "anon": "no", "when": "2015-09-12T07:35:26Z", "type": "followup"}], "bucket_name": "Today", "history": [{"anon": "no", "uid": "i6ry30g7v1z", "subject": "为什么CPU id会不一致呢&#xff1f;", "created": "2015-08-28T15:46:04Z", "content": "<p>现在还可以问问题么&#xff1f;</p>\n<p>QEMU测试ucore&#43;的amd64 smp模式显示&#xff1a;</p>\n<pre>kernel_execve: pid = 8, name = &#34;/bin/sh&#34;.\nstart refcache test 1 1\nstart refcache test 1 2\nkernel panic at refcache.c:223:\n    assertion failed: current-&gt;cpu_affinity == id\nWelcome to the kernel debug monitor!!\nType &#39;help&#39; for a list of commands.\nK&gt; Welcome to sh!</pre>\n<p>比较疑惑的是为什么CPU id不相等呢&#xff1f;</p>\n<p>在下面的assert出错了&#xff1a;</p>\n<pre>int krefcache_cleaner(void *arg)\n{\n int id = myid();\n kprintf(&#34;start refcache test %d %d\\n&#34;, id, current-&gt;cpu_affinity);\n assert(current-&gt;cpu_affinity == id);</pre>\n<p>cpu_affinity是proc_struct结构的成员&#xff0c;申请一个进程会把它赋值为当前CPU id</p>\n<pre>struct proc_struct *alloc_proc(void)\n{\n struct proc_struct *proc = kmalloc(sizeof(struct proc_struct));\n if (proc != NULL) {\n ...\n  proc-&gt;cpu_affinity = myid();\n ... \n }\n return proc;\n}</pre>\n<p>但是为什么当前CPU的ID跟当前进程的CPU ID不同呢&#xff1f;</p>\n<p>调用过程&#xff1a;</p>\n<pre>kern_init() --&gt;<br />bootaps() --&gt;<br />cpu_up() --&gt;<br />kern_ap_entry64 --&gt;<br />ap_init() --&gt; <br />proc_init_ap()<br />{<br />...<br />#if 1<br /> int pid;<br /> char proc_name[32];<br /> <br /> //krefcache_cleaner()&#xff01;<br /> if((pid = ucore_kernel_thread(krefcache_cleaner, NULL, 0)) &lt;= 0){<br />  panic(&#34;krefcache_cleaner init failed.\\n&#34;);<br /> }<br /> struct proc_struct* cleaner = find_proc(pid);<br /> snprintf(proc_name, 32, &#34;krefcache/%d&#34;, myid());<br /> set_proc_name(cleaner, proc_name);<br /> set_proc_cpu_affinity(cleaner, myid());<br /> nr_process&#43;&#43;;<br />#endif<br />...<br />}</pre>\n<p>QEMU参数&#xff1a;</p>\n<pre>qemu-system-x86_64 -m 1024 -smp 4 -hda obj/kernel.img -drive file=obj/sfs.img,media=disk,cache=writeback,index=2 -s -serial file:obj/serial.log -monitor stdio</pre>\n<p></p>"}, {"anon": "no", "uid": "i6ry30g7v1z", "subject": "为什么CPU id会不一致呢&#xff1f;", "created": "2015-08-28T10:03:58Z", "content": "<p>现在还可以问问题么&#xff1f;</p>\n<p>QEMU测试ucore&#43;的amd64 smp模式显示&#xff1a;</p>\n<pre>kernel_execve: pid = 8, name = &#34;/bin/sh&#34;.\nstart refcache test 1 1\nstart refcache test 1 2\nkernel panic at refcache.c:223:\n    assertion failed: current-&gt;cpu_affinity == id\nWelcome to the kernel debug monitor!!\nType &#39;help&#39; for a list of commands.\nK&gt; Welcome to sh!</pre>\n<p>比较疑惑的是为什么CPU id不相等呢&#xff1f;</p>\n<p>在下面的assert出错了&#xff1a;</p>\n<pre>int krefcache_cleaner(void *arg)\n{\n int id = myid();\n kprintf(&#34;start refcache test %d %d\\n&#34;, id, current-&gt;cpu_affinity);\n assert(current-&gt;cpu_affinity == id);</pre>\n<p>cpu_affinity是proc_struct结构的成员&#xff0c;申请一个进程会把它赋值为当前CPU id</p>\n<pre>struct proc_struct *alloc_proc(void)\n{\n struct proc_struct *proc = kmalloc(sizeof(struct proc_struct));\n if (proc != NULL) {\n ...\n  proc-&gt;cpu_affinity = myid();\n ... \n }\n return proc;\n}</pre>\n<p>但是为什么当前CPU的ID跟当前进程的CPU ID不同呢&#xff1f;</p>\n<pre>qemu-system-x86_64 -m 1024 -smp 4 -hda obj/kernel.img -drive file=obj/sfs.img,media=disk,cache=writeback,index=2 -s -serial file:obj/serial.log -monitor stdio</pre>\n<p></p>"}, {"anon": "no", "uid": "i6ry30g7v1z", "subject": "为什么CPU id会不一致呢&#xff1f;", "created": "2015-08-28T10:02:15Z", "content": "<p>现在还可以问问题么&#xff1f;</p>\n<p>QEMU测试ucore&#43;的amd64 smp模式显示&#xff1a;</p>\n<pre>kernel_execve: pid = 8, name = &#34;/bin/sh&#34;.\nstart refcache test 1 1\nstart refcache test 1 2\nkernel panic at refcache.c:223:\n    assertion failed: current-&gt;cpu_affinity == id\nWelcome to the kernel debug monitor!!\nType &#39;help&#39; for a list of commands.\nK&gt; Welcome to sh!</pre>\n<p>比较疑惑的是为什么CPU id不相等呢&#xff1f;</p>\n<pre>int krefcache_cleaner(void *arg)\n{\n int id = myid();\n kprintf(&#34;start refcache test %d %d\\n&#34;, id, current-&gt;cpu_affinity);\n assert(current-&gt;cpu_affinity == id);</pre>\n<p>cpu_affinity是proc_struct结构的成员&#xff0c;申请一个进程会把它赋值为当前CPU id</p>\n<pre>struct proc_struct *alloc_proc(void)\n{\n struct proc_struct *proc = kmalloc(sizeof(struct proc_struct));\n if (proc != NULL) {\n ...\n  proc-&gt;cpu_affinity = myid();\n ... \n }\n return proc;\n}</pre>\n<p>但是为什么执行CPU的ID跟当前进程的CPU ID不同呢&#xff1f;</p>\n<pre>qemu-system-x86_64 -m 1024 -smp 4 -hda obj/kernel.img -drive file=obj/sfs.img,media=disk,cache=writeback,index=2 -s -serial file:obj/serial.log -monitor stdio</pre>\n<p></p>"}, {"anon": "no", "uid": "i6ry30g7v1z", "subject": "为什么CPU id会不一致呢&#xff1f;", "created": "2015-08-28T09:58:27Z", "content": "<p>现在还可以问问题么&#xff1f;</p>\n<p>QEMU测试ucore&#43;的amd64模块显示&#xff1a;</p>\n<pre>kernel_execve: pid = 8, name = &#34;/bin/sh&#34;.<br />start refcache test 1 1<br />start refcache test 1 2<br />kernel panic at refcache.c:223:<br />    assertion failed: current-&gt;cpu_affinity == id<br />Welcome to the kernel debug monitor!!<br />Type &#39;help&#39; for a list of commands.<br />K&gt; Welcome to sh!</pre>\n<p>比较疑惑的是为什么CPU id不相等呢&#xff1f;</p>\n<pre>int krefcache_cleaner(void *arg)<br />{<br /> int id = myid();<br /> kprintf(&#34;start refcache test %d %d\\n&#34;, id, current-&gt;cpu_affinity);<br /> assert(current-&gt;cpu_affinity == id);</pre>\n<p>cpu_affinity是proc_struct结构的成员&#xff0c;申请一个进程会把它赋值为当前CPU id</p>\n<pre>struct proc_struct *alloc_proc(void)<br />{<br /> struct proc_struct *proc = kmalloc(sizeof(struct proc_struct));<br /> if (proc != NULL) {<br /> ...<br />  proc-&gt;cpu_affinity = myid();<br /> ... <br /> }<br /> return proc;<br />}</pre>\n<p>但是为什么执行CPU的ID跟当前进程的CPU ID不同呢&#xff1f;</p>"}], "type": "question", "tags": ["student", "ucore_plus"], "tag_good": [], "unique_views": 99, "children": [{"folders": [], "data": {"embed_links": []}, "children": [], "created": "2015-09-12T05:56:22Z", "bucket_order": 3, "tag_endorse": [{"role": "student", "name": "再度燃烧", "endorser": {}, "admin": false, "photo": "1425340926_35.png", "id": "i6ry30g7v1z", "photo_url": "https://d1b10bmlvqabco.cloudfront.net/photos/i6ry30g7v1z/1425340926_35.png", "published": true, "us": false, "facebook_id": null}], "bucket_name": "Today", "id": "iegntpjteix2su", "history": [{"anon": "no", "uid": "hdjonbiyfs62ie", "subject": "", "created": "2015-09-12T05:56:22Z", "content": "<p>操作系统课程的问题还是可以继续提问&#xff0c;只是没有助教了&#xff0c;老师的回复不会那么及时了。</p>\n<p></p>\n<p>你问的ucore&#43;问题&#xff0c;老师们在没有仔细看代码的时候也很难回答了。通常会对操作系统十分有兴趣的同学&#xff0c;在操作系统专题训练课上讨论的内容。这时问答也不同学提问&#xff0c;老师解答&#xff0c;因为老师也回答不上来了。这时的做法是&#xff0c;同学描述遇到的问题和困惑&#xff1b;与老师和其他同学一起讨论&#xff0c;提可能的解决或尝试思路&#xff1b;提问同学按讨论思路进行尝试&#xff0c;并通报尝试结果。</p>\n<p></p>\n<p>如果还有其他同学对ucore&#43;有兴趣&#xff0c;可一起形成一个小组&#xff0c;在ucore&#43;上做一些有兴趣的事。wiki上专题训练课的页面上有一些相关信息&#xff0c;可供参考。</p>"}], "type": "i_answer", "tag_endorse_arr": ["i6ry30g7v1z"], "config": {}, "is_tag_endorse": false}, {"anon": "no", "folders": [], "data": {"embed_links": null}, "no_upvotes": 0, "subject": "<p>感谢向老师回答。∩_∩</p>\n<p>最近在看ucore&#43;的代码&#xff0c;能自己调试解决更好一些&#xff0c;只是进度很慢。</p>\n<p>对于原来没有自己进行调试以及深入理解代码就提问感到惭愧。</p>\n<p></p>\n<p></p>\n<p></p>", "created": "2015-09-12T07:35:26Z", "bucket_order": 239, "bucket_name": "Week 9/6 - 9/12", "type": "followup", "tag_good": [], "uid": "i6ry30g7v1z", "children": [], "tag_good_arr": [], "no_answer": 0, "id": "iegrd3w2tdr14e", "updated": "2015-09-12T07:35:26Z", "config": {}}], "tag_good_arr": [], "no_answer": 0, "id": "idvgv8zwxt61y8", "config": {}, "status": "active", "drafts": null, "request_instructor": 0, "request_instructor_me": false, "bookmarked": 4, "num_favorites": 0, "my_favorite": false, "is_bookmarked": false, "is_tag_good": false, "q_edits": [], "i_edits": [], "s_edits": [], "t": 1643167898115, "default_anonymity": "no"}, "error": null, "aid": "kyuzqolfd0y3st"}