{"result": {"folders": ["lecture10"], "nr": 1180, "data": {"embed_links": []}, "created": "2018-03-30T09:29:22Z", "bucket_order": 3, "no_answer_followup": 0, "change_log": [{"anon": "no", "uid": "hcrrjuyequh4bt", "data": "jfdqxuap5424nk", "type": "create", "when": "2018-03-30T09:29:22Z"}], "bucket_name": "Today", "history": [{"anon": "no", "uid": "hcrrjuyequh4bt", "subject": "x86-32中的cr3寄存器放到是啥&#xff0c;可以如何对其进行赋值或读取并会出现啥现象&#xff1f;", "created": "2018-03-30T09:29:22Z", "content": "<p>x86-32中&#xff0c;存储页目录表起始物理地址的是cr3寄存器。其格式如下&#xff1a;</p>\n<p>|31--12: Page-Directory Base|11--5: reserved |4: PCD|3: PWT|2--0:resrved|</p>\n<p></p>\n<p>- PCD:控制当前页目录表的缓冲,当设置清空时,缓冲.置位时,缓冲无效.与CR0中的CD或PG一同使用<br />- PWT:控制cache采取直写还是回写的策略.当设置清空时,回写有效.当置位时,直写有效.</p>\n<p></p>\n<p>所以&#xff0c;当CR3的PCD和PWT位都为0时&#xff0c;表示当前x86会缓冲当前页目录表&#xff0c;且控制cache采取回写的策略。</p>\n<p>在qemu中&#xff0c;对reserved的单个或部分bit置1&#xff0c;或对PCD/PWT置一&#xff0c;qemu会在未来某个时候访问页错误。<br />在kvm中&#xff0c;对reserved的单个或部分bit置1&#xff0c;系统正常&#xff1b;对PCD/PWT置一&#xff0c;qemu会在未来某个时候访问页错误。</p>\n<p>所以&#xff0c;如果给cr3赋值时&#xff0c;不把低12位清零&#xff0c;系统有潜在错误的风险。<br />在ucore做法中&#xff0c;给cr3赋值的一定是4k对齐的一个物理地址&#xff0c;cpu会把此地址作为页目录表的基地址。</p>\n<p>实验&#xff1a;<br />&#96;&#96;&#96;<br /> pdtaddr=rcr3();<br /> cprintf(&#34;S1: cr3 is %x\\n&#34;,pdtaddr);<br /> pdtaddr=pdtaddr|16;<br /> cprintf(&#34;S2: cr3 is %x\\n&#34;,pdtaddr);<br /> lcr3(pdtaddr);<br /> pdtaddr=rcr3();<br /> cprintf(&#34;S3: cr3 is %x\\n&#34;,pdtaddr);</p>\n<p></p>\n<p>用qemu或kvm执行&#xff0c;结果为</p>\n<p></p>\n<p>S1: cr3 is 120000<br />S2: cr3 is 120010<br />S3: cr3 is 120010</p>\n<p>&#96;&#96;&#96;</p>"}], "type": "note", "tags": ["instructor-note", "lecture10"], "tag_good": [], "unique_views": 109, "children": [], "tag_good_arr": [], "id": "jfdqxualjb54nj", "config": {}, "status": "active", "drafts": null, "request_instructor": 0, "request_instructor_me": false, "bookmarked": 1, "num_favorites": 1, "my_favorite": false, "is_bookmarked": false, "is_tag_good": false, "q_edits": [], "i_edits": [], "s_edits": [], "t": 1643169342044, "default_anonymity": "no"}, "error": null, "aid": "kyv0lmqkvwb29e"}